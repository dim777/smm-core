buildscript {
    repositories {
        mavenCentral()
        maven { url "https://plugins.gradle.org/m2/" }
    }
    dependencies {
        classpath "org.openapitools:openapi-generator-gradle-plugin:6.3.0"
    }
}

apply plugin: "java"
apply plugin: "org.openapi.generator"

dependencies {
    implementation libraries.swagger2
    implementation libraries.swagger_ui
    implementation libraries.gson
    implementation libraries.javaxAnnotation
    implementation 'com.google.code.findbugs:jsr305:3.0.2'
    implementation libraries.jooq
}

tasks.build.dependsOn(tasks.openApiGenerate)

openApiGenerate {
    generatorName = "java"
    verbose = true
    validateSpec = false
    skipValidateSpec = true
    inputSpec = "$rootDir/services/lib-common-strava/src/main/resources/strava/swagger.json"
    outputDir = "$buildDir/generated".toString()
    apiPackage = "tech.ineb.sport.lib.common.strava.client.api"
    modelPackage = "tech.ineb.sport.lib.common.strava.model"

    modelFilesConstrainedTo = [""]
    apiFilesConstrainedTo = ["Error"]
    supportingFilesConstrainedTo = ["Error"]

    configOptions = [
            dateLibrary: "java8"
    ]
}

sourceSets {
    main {
        java.srcDirs += ["${buildDir}/generated/src/main/java/"]
    }
}

compileJava {
    dependsOn tasks.openApiGenerate
}